# Application Routes

## Status Legend
- âœ… **Used** - Active route in production
- ğŸ‘» **Ghost** - Deprecated route (redirects or 404)
- ğŸš§ **WIP** - Work in progress
- ğŸ“ **Planned** - Planned for future

## Routes Inventory

### Auth
| Route | Status | Description | Auth |
|-------|--------|-------------|------|
| `/login` | âœ… Used | Login / sign-up page (invite-only) | Public |
| `/auth/callback` | âœ… Used | Supabase OAuth callback | Public |
| `/onboarding` | âœ… Used | Company invite activation | Public |

### Platform Admin
| Route | Status | Description | Auth |
|-------|--------|-------------|------|
| `/platform` | âœ… Used | Platform admin: create & manage invites | Admin only |

### Dashboard
| Route | Status | Description |
|-------|--------|-------------|
| `/` | âœ… Used | Main dashboard |

### Analytics
| Route | Status | Description |
|-------|--------|-------------|
| `/analytics` | âœ… Used | Analytics dashboard |

### Assets Management
| Route | Status | Description |
|-------|--------|-------------|
| `/assets` | âœ… Used | Assets list |
| `/assets/[id]` | âœ… Used | Asset detail page |

### Auto Platform (Cars)
| Route | Status | Description |
|-------|--------|-------------|
| `/cars` | âœ… Used | Cars inventory |
| `/cars/[id]` | âœ… Used | Car detail page |
| `/cars/clients/[id]` | âœ… Used | Auto client detail |
| `/cars/deals/[id]` | âœ… Used | Auto deal detail |
| `/cars/stock` | âœ… Used | Cars stock management |

### Contacts (CRM)
| Route | Status | Description |
|-------|--------|-------------|
| `/contacts` | âœ… Used | Contacts list |
| `/contacts/[id]` | âœ… Used | Contact detail page |

### Deals (Legacy)
| Route | Status | Description |
|-------|--------|-------------|
| `/deals` | âœ… Used | Deals list (legacy module) |
| `/deals/[id]` | âœ… Used | Deal detail (legacy) |

### Finance Deals
| Route | Status | Description |
|-------|--------|-------------|
| `/finance-deals` | âœ… Used | Finance deals list |
| `/finance-deals/[id]` | âœ… Used | Finance deal detail |

### Finance (Cashboxes)
| Route | Status | Description |
|-------|--------|-------------|
| `/finance` | âœ… Used | Finance dashboard & internal exchange |
| `/finance/[id]` | âœ… Used | Cashbox detail |

### Exchange (Client Exchange)
| Route | Status | Description |
|-------|--------|-------------|
| `/exchange` | âœ… Used | Client exchange interface |

### Exchange Deals (Ghost - Deprecated)
| Route | Status | Description |
|-------|--------|-------------|
| `/exchange-deals` | ğŸ‘» Ghost | Redirects to `/exchange` |
| `/exchange-deals/[id]` | ğŸ‘» Ghost | Redirects to `/exchange` |
| `/exchange-deals/new` | ğŸ‘» Ghost | Redirects to `/exchange` |

### HR
| Route | Status | Description |
|-------|--------|-------------|
| `/hr` | âœ… Used | HR dashboard |
| `/hr/[id]` | âœ… Used | Employee detail |

### Settings
| Route | Status | Description |
|-------|--------|-------------|
| `/settings` | âœ… Used | Application settings |

### Stock Management
| Route | Status | Description |
|-------|--------|-------------|
| `/stock` | âœ… Used | Stock inventory |
| `/stock/[id]` | âœ… Used | Stock item detail |

---

## Route Audit Log

**Last updated:** Auto-generated by route-audit script
**Total routes:** 30
**Active routes:** 27
**Ghost routes:** 3

## Notes

### Internal vs Client Exchange Separation
- `/finance` - Internal exchange operations (Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ²Ğ¾Ğ¸Ğ¼Ğ¸ ĞºĞ°ÑÑĞ°Ğ¼Ğ¸)
- `/exchange` - Client exchange operations (Ñ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°Ğ³ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸)
- Ghost routes `/exchange-deals/*` deprecated in favor of unified `/exchange` interface

### Authentication Architecture
- **Middleware** (`middleware.ts` + `lib/supabase/middleware.ts`): Refreshes Supabase session tokens on every request. Redirects unauthenticated users to `/login` (except public paths: `/login`, `/auth/*`, `/onboarding`, `/platform`, `/_next/*`, `/api/*`, static assets). **Onboarding gate**: authenticated users without team membership (and not platform admin) are redirected to `/onboarding`.
- **Server Actions**: Every exported function in `app/actions/*.ts` calls `await requireUser()` as first line. Throws `'Unauthorized'` if no session.
- **API Routes**: `app/api/upload/route.ts` and `app/api/delete/route.ts` call `requireUser()` inside their handlers.
- **Browser Client**: Singleton pattern in `lib/supabase/client.ts` prevents multiple GoTrueClient instances.
- **Public paths**: `/login`, `/auth/callback`, `/onboarding` are accessible without session.

### Multi-Tenant Onboarding (Invite-Only)
- **Registration**: Sign-up is disabled by default on `/login`. Only visible when accessed with `?invite=` or `?token=` query param.
- **Platform Admin**: `cielo1304@gmail.com` has access to `/platform` where they can create company invites.
- **Company Invites**: Platform admin creates invite with email + company name. System generates UUID token and stores in `company_invites` table.
- **Activation Flow**: Boss receives invite link `/onboarding?token=<uuid>`, enters full name, system calls `accept_company_invite(token, full_name)` RPC which creates company and team membership.
- **Middleware Gate**: After login, if user has no team membership and is not platform admin, redirected to `/onboarding?next=<path>`.

### Route Naming Conventions
- Plural nouns for list pages: `/contacts`, `/deals`, `/assets`
- `[id]` for detail pages: `/contacts/[id]`
- Nested resources: `/cars/clients/[id]`
- Action pages with descriptive names: `/cars/stock`, `/exchange-deals/new`
